# 浅析DNS域名解析过程

https://cloud.tencent.com/developer/news/324975

对于每一个HTTP请求发起过程中，都有很重要的一个步骤——DNS解析，本篇文章将跟着DNS解析过程来分析域名是如何解析的。

一、DNS域名解析步骤

下图是域名解析的一个示例图，它涵盖了基本解析步骤和原理。

![](F:\Flee-as-a-bird-to-your-mountain\网络协议\域名解析1.peg.jpeg)



下面解析步骤进行讲解，后面将采用命令行的形式来跟踪解析过程。当用户在地址栏键入并敲下回车键之后，域名解析就开始了。

**第一步：检查浏览器缓存中是否缓存过该域名对应的IP地址**

用户通过浏览器浏览过某网站之后，浏览器就会自动缓存该网站域名对应的地址，当用户再次访问的时候，浏览器就会从缓存中查找该域名对应的IP地址，因为缓存不仅是有大小限制，而且还有时间限制（域名被缓存的时间通过属性来设置），所以存在域名对应的找不到的情况。当浏览器从缓存中找到了该网站域名对应的地址，那么整个解析过程结束，如果没有找到，将进行下一步骤。对于的缓存时间问题，不宜设置太长的缓存时间，时间太长，如果域名对应的发生变化，那么用户将在一段时间内无法正常访问到网站，如果太短，那么又造成频繁解析域名。

**第二步：如果在浏览器缓存中没有找到IP，那么将继续查找本机系统是否缓存过IP**

如果第一个步骤没有完成对域名的解析过程，那么浏览器会去系统缓存中查找系统是否缓存过这个域名对应的地址，也可以理解为系统自己也具备域名解析的基本能力。在系统中，可以通过设置文件来将域名手动绑定到某上，文件位置在。对于普通用户，并不推荐自己手动绑定域名和，对于开发者来说，通过绑定域名和，可以轻松切换环境，可以从测试环境切换到开发环境，方便开发和测试。在系统中，黑客常常修改他的电脑的文件，将用户常常访问的域名绑定到他指定的上，从而实现了本地解析，导致这些域名被劫持。在或者系统中，文件在，修改该文件也可以实现同样的目的。

前两步都是在本机上完成的，所以没有在上面示例图上展示出来，从第三步开始，才正在地向远程DNS服务器发起解析域名的请求。

**第三步：向本地域名解析服务系统发起域名解析的请求**

如果在本机上无法完成域名的解析，那么系统只能请求本地域名解析服务系统进行解析，本地域名系统一般都是本地区的域名服务器，比如你连接的校园网，那么域名解析系统就在你的校园机房里，如果你连接的是电信、移动或者联通的网络，那么本地域名解析服务器就在本地区，由各自的运营商来提供服务。对于本地服务器地址，系统使用命令就可以查看，在和系统下，直接使用命令来查看服务地址。一般都缓存了大部分的域名解析的结果，当然缓存时间也受域名失效时间控制，大部分的解析工作到这里就差不多已经结束了，负责了大部分的解析工作。

**第四步：向根域名解析服务器发起域名解析请求**

本地域名解析器还没有完成解析的话，那么本地域名解析服务器将向根域名服务器发起解析请求。

**第五步：根域名服务器返回gTLD域名解析服务器地址**

本地域名解析向根域名服务器发起解析请求，根域名服务器返回的是所查域的通用顶级域（）地址，常见的通用顶级域有、、、等。

**第六步：向gTLD服务器发起解析请求**

本地域名解析服务器向gTLD服务器发起请求。

**第七步：gTLD服务器接收请求并返回Name Server服务器**

服务器接收本地域名服务器发起的请求，并根据需要解析的域名，找到该域名对应的域名服务器，通常情况下，这个服务器就是你注册的域名服务器，那么你注册的域名的服务商的服务器将承担起域名解析的任务。

**第八步：Name Server服务器返回IP地址给本地服务器**

服务器查找域名对应的地址，将地址连同值返回给本地域名服务器。

**第九步：本地域名服务器缓存解析结果**

本地域名服务器缓存解析后的结果，缓存时间由时间来控制。

**第十步：返回解析结果给用户**

解析结果将直接返回给用户，用户系统将缓存该地址，缓存时间由来控制，至此，解析过程结束。

这里对解析的步骤进行了一个简单的介绍分析，后面将通过命令行的形式来解析一个域名的具体解析过程。

二、DNS域名解析过程分析

在正式开始分析解析过程之前，先来介绍几个基本的域名解析方式的概念。域名解析记录主要分为、、、以及。

：代表的是，用来指定域名对应的地址，比如将指定到，将指定到，记录允许将多个域名解析到一个地址，但不允许将一个域名解析到多个IP地址上。

：代表的是，就是可以将某个域名下的邮件服务器指向自己的，如域名的记录地址是，如果将记录设置为，即的邮件路由，那么会将邮件发送到所在的服务器，而正常请求仍然会解析到记录的IP地址。

：指的就是，也就是别名解析，可以将指定的域名解析到其他域名上，而其他域名就是指定域名的别名，整个解析过程称为别名解析。比如将解析到，将解析到，那么就是和的别名。

：就是为某个域名指定了特定的服务器去解析。

：为某个主机名或者域名设置特定的说明，比如为设置的的TXT记录为，这个记录为的说明。

上面概念中的地址都是假定的，帮助理解。下面将通过解析域名为例，进一步说明域名解析流程。

直接查看域名结果，可以通过命令加上域名来查看：



![img](https://ask.qcloudimg.com/http-save/developer-news/26c09fp251.jpeg?imageView2/2/w/1620)

上图中表示解析结果来自非权威服务器，也就是说这个结果来自缓存，并没有完全经历全部的解析过程，从某个缓存中读取的结果，这个结果存在一定的隐患，比如域名对应的地址已经更变。

这只是一个快捷的解析结果，如果需要浏览全部的解析过程，那么可以使用命令来查看解析过程。



![img](https://ask.qcloudimg.com/http-save/developer-news/pf32e5q6qm.jpeg?imageView2/2/w/1620)

分析上图解析过程，我们可以看出：

第一步：从本地域名解析服务器获取到个根域名服务器对应的主机名。



![img](https://ask.qcloudimg.com/http-save/developer-news/5uuh2c2hlf.jpeg?imageView2/2/w/1620)

第二步：从个根域名服务器中的其中一个（这里是）获取到顶级的服务器（未显示）和名称。



![img](https://ask.qcloudimg.com/http-save/developer-news/pldrtpzj3g.jpeg?imageView2/2/w/1620)

第三步：向域的一台服务器请求解析，它返回了域的服务器（未显示）和名称，百度有四台顶级域的服务器。



![img](https://ask.qcloudimg.com/http-save/developer-news/waoqj1gal2.jpeg?imageView2/2/w/1620)

第四步：向百度的顶级域服务器请求，它发现这个有个别名，而不是一台主机，别名是。

一般情况下，解析到别名就停止了，返回了具体的地址，如果想看到具体的地址，可以进一步对别名进行解析，解析结果如下：



![img](https://ask.qcloudimg.com/http-save/developer-news/13bcwwkc11.jpeg?imageView2/2/w/1620)

这时候看到最后的解析结果是和。在解析别名的过程中，可以发现和都是指定了相同的域名解析服务器。以上是一个域名的解析过程，最后的解析结果和一开始的使用的结果一致。