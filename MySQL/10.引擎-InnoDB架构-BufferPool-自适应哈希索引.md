# 10.引擎-InnoDB架构-Buffer Pool-自适应哈希索引

**目录**

- [前言](#前言)
- [是什么](#是什么)
- [为什么](#为什么)
- [InnoDB哈希索引](#InnoDB哈希索引)
- [相关设置](#相关设置)
- [小知识点](#小知识点)
- [参考链接](#参考链接)



## 前言

![](https://dev.mysql.com/doc/refman/8.0/en/images/innodb-architecture.png)





## 是什么

​		从图中可以看出，**Adaptive Hash Index**（自适应哈希索引） 是 Buffer pool 中独立的一个区域，是一个纯内存结构。

​		Adaptive Hash Index（以下简称 AHI），AHI使InnoDB更像一个内存中的数据库。自适应哈希索引由innodb_adaptive_hash_index变量启用，或者在服务器启动时通过——skip-innodb- adaptivehash -index关闭。

​		AHI 在实现上就是一个**哈希表**：从某个检索条件到某个数据页的哈希表，仿佛并不复杂，但其中的关窍在于哈希表**不能太大**（哈希表维护本身就有成本，哈希表太大则成本会高于收益），**又不能太小**（太小则缓存命中率太低，没有任何收益）。

​		这就是 AHI中＂自适应＂的用途：建立一个＂不大不小刚刚好＂的哈希表。





## 为什么

- 随着 MySQL 单表数据量增大，（尽管 B+ 树算法极好地控制了树的层数）索引 B+ 树的层数会逐渐增多；
- 随着索引树层数增多，检索某一个数据页需要沿着 B+ 树从上往下逐层定位，时间成本就会上升；
- 为解决检索成本问题，MySQL 就想到使用某一种缓存结构：根据某个检索条件，直接查询到对应的数据页，跳过逐层定位的步骤。这种缓存结构就是 AHI。





## InnoDB哈希索引

​		InnoDB支不支持哈希索引？



​		虽然MySQL支持创建哈希索引的语法，但是InnoDB用户无法手动正真创建出哈希索引，从这个角度来说，InnoDB确实不支持哈希索引；

​		InnoDB会进行自调优（Self-tuning），如果判定建立Adaptive Hash Index，能够提升查询效率，InnoDB自己会在内存中建立相关哈希索引（所以这就是Adaptive——“自适应”的由来），不需要人工手动干预，InnoDB会根据所需自己创建自适应哈希索引。所以，从这个角度来说，InnoDB是支持哈希索引的。







## 参考链接

[https://www.modb.pro/db/113573](https://www.modb.pro/db/113573)

[https://segmentfault.com/a/1190000021749367](https://segmentfault.com/a/1190000021749367)

[https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html](https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html)