### 进程、线程和协程

#### 进程

​		进程（Process）是**系统进行资源分配和调度的基本单位**，是操作系统的基础。

　　进程是一个具有独立功能的程序关于某个数据集合的一次运行活动。它可以申请和拥有系统资源，是一个动态的概念，是一个活动的实体。它不只是程序的[代码](http://baike.baidu.com/view/41.htm)，还包括当前的活动。

　　进程的概念主要有两点：

1. 进程是一个实体。**每一个进程都有它自己的地址空间**，一般情况下，包括文本区域（text region）、数据区域（data region）和堆栈（stack region）。
   - 文本区域存储处理器执行的代码；
   - 数据区域存储变量和进程执行期间使用的动态分配的内存；
   - 堆栈区域存储着活动过程调用的指令和本地变量。
2. 进程是一个“执行中的程序”。程序是一个没有生命的实体，只有CPU赋予程序生命时（操作系统执行之），它才能成为一个活动的实体，我们称其为**进程**



​		进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，进程是系统进行资源分配和调度的一个独立单位。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。**由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（栈、寄存器、虚拟内存、文件句柄等）比较大，但相对比较稳定安全。**



#### 线程

​		**线程是进程的一个实体，是CPU调度和分派的基本单位**，它是比进程更小的能独立运行的基本单位。

​		**线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源(如程序计数器，一组寄存器和栈)**，但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

​		一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行。由于线程之间的相互制约，致使线程 在运行中呈现出间断性。

​		线程也有**就绪**、**阻塞**和**运行**三种基本状态。就绪状态是指线程具备运行的所有条件，逻辑上可以运行，在等待处理机；运行状态是指线程占有处理机正在运行；阻塞状态是指线程在等待一个事件（如某个信号量），逻辑上不可执行。每一个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。

​		线程是程序中一个单一的顺序控制流程。进程内一个相对独立的、可调度的执行单元，是系统独立调度和分派CPU的基本单位指[运行](http://baike.baidu.com/view/1026025.htm)中的程序的调度单位。在单个程序中同时运行多个线程完成不同的工作，称为多线程



#### 协程

​		**协程是一种用户态的轻量级线程，**协程的调度完全由**用户控制**。

​		协程拥有自己的寄存器上下文和栈。

​		协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。





### 进程、线程、协程的区别

#### 概念

​		对于进程来说，子进程是父进程的复制品，从父进程那里获得父进程的数据空间，堆和栈的复制品。

​		而线程，相对于进程而言，是一个更加接近于执行体的概念，可以和同进程的其他线程之间直接共享数据，而且拥有自己的栈空间，拥有独立序列。



#### 进程、线程共同点

​		它们都能提高程序的并发度，提高程序运行效率和响应时间。线程和进程在使用上各有优缺点。 线程执行开销比较小，但不利于资源的管理和保护，而进程相反。同时，线程适合在SMP机器上运行，而进程可以跨机器迁移。



#### 进程、线程不同点

多进程中每个进程有自己的地址空间，线程则共享地址空间。

所有其他区别都是因为这个区别产生的。比如说：

1. 地址空间:线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间

2. 资源拥有:进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源

3. 线程是处理器调度的基本单位，但进程不是

4. 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制

   

 

> \1. 速度。线程产生的速度快，通讯快，切换快，因为他们处于同一地址空间。 
> \2. 线程的资源利用率好。 
> \3. 线程使用公共变量或者内存的时候需要同步机制，但进程不用。

而他们通信方式的差异也仍然是由于这个根本原因造成的。



#### 线程、协程比较

1. 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。
2. 线程进程都是同步机制，而协程则是异步
3. 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态



#### 通信方式之间的差异

​	因为那个根本原因，实际上只有进程间需要通信，同一进程的线程共享地址空间，没有通信的必要，但要做好同步/互斥，保护共享的全局变量。

​	而进程间通信无论是信号，管道pipe还是共享内存都是由操作系统保证的，是系统调用。