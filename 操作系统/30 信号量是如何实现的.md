### 信号量是如何实现的？

# 或者可以说是

### 信号量的原子操作是如何实现的？

```
信号量是建立在原子操作基础上的。

信号量实现的关键在于，如何原子地递增或者递减一个变量？

对于单 CPU 系统，在 x86 平台有对指定内存递增和递减的指令。然而，对多 CPU 系统这样仍然不够。为此，在多数 CPU 平台，使用特定的 lock 前缀，使得在指令执行过程中锁住内存总线，这样其它 CPU 由于得不到总线仲裁的许可，无法同时修改其值。

进程执行 P 操作的时候，首先原子地递减相应的计数，如果执行完之后小于零，则失败，扔到等待队列中。这个检查检查的是递减指令执行之后的标志，存放于 CPU 自己的寄存器中，不会与其它 CPU 共享，所以总是准确的。V 操作类似。
```

> https://segmentfault.com/q/1010000000322436