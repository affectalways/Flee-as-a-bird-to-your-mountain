# 07.增删改

### 插入

- 语法

```
db.集合名称.insert(document)
```

- 插入文档时，如果不指定_id参数，MongoDB会为文档分配一个唯一的ObjectId
- 例1

```
db.stu.insert({name:'gj',gender:1})
```

- 例2

```
s1={_id:'20160101',name:'hr'} s1.gender=0 db.stu.insert(s1)
```





### 简单查询

- 语法

```
db.集合名称.find()
```

![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0701.png)





### 更新

- 语法

```
db.集合名称.update(  query,  update,  {multi: } )
```

- 参数query:查询条件，类似sql语句update中where部分
- 参数update:更新操作符，类似sql语句update中set部分
- 参数multi:可选，默认是false，表示只更新找到的第一条记录，值为true表示把满足条件的文档全部更新

**出现错误：**

 ![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0702.png)

**错误原因：**

  因为给people集合设置了capped，如下图，不能更改文档的大小，否则操作失败。

  而db.people.update({}, {name:"all"})会修改文档大小，将源文档{name:"hello", addr:1}变为{name:"all"}，改变了文档大小，所以操作失败。

 ![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0703.png)

**像下面，不设置capped，就没有任何事。**

 ![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0704.png)

![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0705.png)



![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0706.png)



- **例4：指定属性更新，通过操作符$set**

```
db.stu.insert({name:'hr',gender:0}) 

db.stu.update({name:'hr'},{$set:{name:'hys'}})
```



- **例5：修改多条匹配到的数据**

```
db.stu.update({},{$set:{gender:0}},{multi:true})
```

**错误：是下面这个图的错误multi update only works with $ operators**

![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0707.png)

**解决方法：**

  **multi 使用时，需要与 $set 一起。(只会修改对应的列，若对应的列不存在，就会添加进去)**

The error says it all: You can only modify multiple documents using the [$ modifier operators](http://www.mongodb.org/display/DOCS/Updating#Updating-ModifierOperations). You probably had something like this:

\> db.coll.update({ }, { a: 'b' }, false, true);

Which would normally *replace* the first object in the collection with { a: 'b' } if multi was false. You wouldn't want to replace all the objects in your collection with the same document!

Use the [$set operator](http://www.mongodb.org/display/DOCS/Updating#Updating-%24set) instead:

\> db.coll.update({ }, { '$set': { a: 'b' } }, false, true);

This will set the a property of every document (creating it as necessary) to 'b'.

解决：

![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0708.png)





### 保存

- 语法

```
db.集合名称.save(document)
```

- 如果文档的_id已经存在则修改，如果文档的_id不存在则添加
- 例

```
db.stu.save({_id:'20160102','name':'yk',gender:1})
```



- 例

```
db.stu.save({_id:'20160102','name':'wyk'})
```

   ![](https://raw.githubusercontent.com/affectalways/Flee-as-a-bird-to-your-mountain/main/img/0709.png)



**总结**

1. insert: 若新增数据的主键已经存在，则会抛 org.springframework.dao.DuplicateKeyException 异常提示主键重复，不保存当前数据。
2. save: 若新增数据的主键已经存在，则会对当前已经存在的数据进行修改操作。





### 删除

- 语法

```
db.集合名称.remove(  query,  {   justOne:   } )
```

- 参数query:可选，删除的文档的条件
- 参数justOne:可选，如果设为true或1，则只删除一条，默认false，表示删除多条



- 例：只删除匹配到的第一条

```
db.stu.remove({gender:0},{justOne:true})
```



- 例：全部删除

```
db.stu.remove({})
```

![](D:\git_code\Flee-as-a-bird-to-your-mountain\MongoDB\pictures\0710.png)





### 关于size使用的示例

例子：

- 创建集合

```
db.createCollection('sub',{capped:true,size:10})
```

- 插入第一条数据库查询

```
db.sub.insert({title:'linux',count:10}) 

db.sub.find()
```

- 插入第二条数据库查询

```
db.sub.insert({title:'web',count:15}) 

db.sub.find()
```

- 插入第三条数据库查询

```
db.sub.insert({title:'sql',count:8}) 

db.sub.find()
```

- 插入第四条数据库查询

```
db.sub.insert({title:'django',count:12}) 

db.sub.find()
```

- 插入第五条数据库查询

```
db.sub.insert({title:'python',count:14}) 

db.sub.find()
```

**自己测试共插入9条数据，然后后面插入的数据，将前面的数据覆盖了。**