# python中线程和协程的区别

#### 目录

- [提前总结](#提前总结)
- [线程](#线程)
- [协程](#协程)
- [协程与线程的比较](#协程与线程的比较)
- [线程、协程在python中的使用](#线程、协程在python中的使用)
- [总结](#总结)



</br></br>

#### 提前总结

- 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU
- 线程是同步机制，而协程是异步
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态



</br></br>

首先我们来了解一下线程和协程的概念

#### 线程

线程是进程的一个实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位.

线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源(如程序计数器，一组寄存器和栈)，但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。

线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。



</br></br>

#### 协程

协程是一种用户态的轻量级线程，协程的调度完全由用户控制。

协程拥有自己的寄存器上下文和栈。

协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。



</br></br>

#### 协程与线程的比较

- 一个线程可以拥有多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。
- 线程进程都是同步机制，而协程则是异步。
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态。



</br></br>

#### 线程、协程在python中的使用

- 多线程一般是使用threading库，完成一些IO密集型并发操作。多线程的优势是切换快，资源消耗低，但一个线程挂掉则会影响到所有线程，所以不够稳定。现实中使用线程池的场景会比较多，具体可参考《python线程池实现》。
- 协程一般是使用gevent库，当然这个库用起来比较麻烦，所以使用的并不是很多。相反，协程在tornado的运用就多得多了，使用协程让tornado做到单线程异步，据说还能解决的问题。所以协程使用的地方最多的是在web应用上。



</br></br>

#### 总结

IO密集型一般使用多线程或者多进程，CPU密集型一般使用多进程，强调非阻塞异步并发的一般都是使用协程，当然有时候也是需要多进程线程池结合的，或者是其他组合方式。

- 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU
- 线程是同步机制，而协程是异步
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

